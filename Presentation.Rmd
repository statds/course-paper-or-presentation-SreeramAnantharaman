---
title: "Introduction to Duration Models"
author: "Sreeram Anantharaman"
date: '2022-11-14'
output: beamer_presentation
---

## Introduction

- Duration models are concerned with time intervals between events.

- Engle and Russell (1998) \cite{ACD} introduced the Autoregressive Conditional Duration model, which presents a new way of modelling random durations arising from high frequency data. 

- ACD models were developed to study the dynamic structure of durations in the context of irregularly spaced financial transactions data. 

- The model treats the time between events as a stochastic process and proposes a new class of point processes with dependent arrival rates.

## Introduction (Cont..) 

- This presentation provides an overview of different techniques to model durations.

- Several simulation studies are presented for different types of Log-ACD models.

- We have also shown an example where a log ACD model is fit to wave height durations which is a very different example of the application. 

## Background

- The Autoregressive Conditional Heteroskedasticity (ARCH) and Generalized Autoregressive Conditional Heteroskedasticity (GARCH) models are considered an important modeling tool if the goal of the study is to analyze and forecast volatility in a data especially in financial applications. 

- In a linear regression the variances of the error terms are assumed to be constant throughout the data. 

- If this is not satisfied then we say the data is affected by Heteroskedasticity. 

- In that case linear model may not provide precise conclusions. 

- This situation is tackled by the ARCH/GARCH framework which models these variances.

## Relationship between GARCH and ACD

- Several models have been developed from the ARCH/GARCH models. 

- One such model is the Autoregressive Conditional Duration (ACD) model. 

- Especially the ACD model is considered as an counterpart of the GARCH model. 

- The ACD model is used to analyze the financial durations rather than the returns. 

- That is, instead of modeling the conditional variances we model the conditional mean of the durations.

## Motivation for Duration Models

- Longer duration indicate lack of trading activity which implies that there is no new information. 

- Arrival of new information leads to more activity which in turn implies shorter durations.

- Thus the behaviour of the durations provide useful information about the market.

## ACD Model

- The ACD model are defined in terms of conditional density of durations. 

The $i^{th}$ duration is defined as time interval between the events occuring at time $t_i$ and $t_{i-1}$:

$x_i = t_i - t_{i-1}$

ACD model assumes that the time dependence between the $i^{th}$ duration and prior durations is completely explained by $\psi_i$.

Let $\psi_i$ be the expectation of the $i^{th}$ duration then we have,

$E(x_i | x_{i-1}, ..., x_1) = \psi_i$ 

## ACD Model (Cont..)

Then the durations $x_i$ as:

$x_i = \psi_i \epsilon_i$

where $\epsilon_i$ are i.i.d non negative random variable with $E(\epsilon_i)=1$ and density function $f_{\epsilon}$. And 

$\psi_i = \omega + \sum_{j=1}^m \alpha_j x_{i-j} + \sum_{j=1}^q \beta_j \psi_{i-j}$

With the following constraints on the coefficients:

$\omega > 0$, $\beta \geq 0$, $\alpha \geq 0$ 

and $\sum_{j=1}^m\alpha + \sum_{j=1}^q\beta < 1$ to ensure non-negativity and weak stationarity of the durations $x_i$.

This is called an $ACD(m, q)$ where the $m$ and $q$ refer to the orders of the lags.

## SCD Model

- Stochastic Conditional duration (SCD) Model was proposed by Bauwens and Veredas (2004) \cite{SCD} and is based on the assumption that there exists a stichastic latent variable that generates the durations. 

The generalized form of the SCD model is:

$x_i = e^{\psi_i} \epsilon_i$

where $\epsilon_i ~$ i.i.d with $E(\epsilon_i)=1$. And 

$\psi_i = \omega + \sum_{j=0}^m \alpha_j x_{i-j} + \sum_{j=0}^q \beta_j \psi_{i-j} + z_i$

where $z_i$ ~ iid $N(0,\sigma_z^2)$ and $z_i$ and $\epsilon_i$ are independent.

The conditional expected duration, which was a fixed function of unknown parameters under the ACD model, is assumed to be a random variable under the SCD model, as in state space models.

## Log-ACD Model

- Bauwens and Giot (2000) \cite{LogACD} proposed the logarithmic-ACD model.

- In the log-ACD model the autoregressive equation is defined as the logarithm of the conditional expectation of the durations. 

- This model relaxes the non-negativity constraint imposed by the ACD model and thus its more flexible than the ACD model. 

Let the conditional expectation of the ith duration be defined as,

$E(x_i | x_{i-1}, ..., x_1) = e^{\phi_i} \mu_{\epsilon}$ 

## Log-ACD Model (Cont..)

Then we define the durations $x_i$ as:

$x_i = e^{\phi_i} \epsilon_i$

where $\epsilon_i$ are i.i.d with $E(\epsilon_i)=\mu_{\epsilon}$. 

Suppose

$\exp(\psi_i) = \exp(\phi_i) \epsilon_i$ 

where

$\psi_i = \omega + \sum_{j=0}^m \alpha_j \log x_{i-j} + \sum_{j=0}^q \beta_j \psi_{i-j}$

Then we can rewrite

$x_i = \frac{e^{\psi_i}}{\mu_{\epsilon}} \epsilon_i$

with the following constraints: $|\alpha_j + \beta_j| < 1$.

## Log-ACD Model (Cont..)

This is called an $Log-ACD(m, q)$ where the $m$ and $q$ refer to the orders of the 
lags. 

Note that if $\mu_{\epsilon}$ = 1, then we can just simply define the model as:

$x_i = \exp(\psi_i) \epsilon_i$

$\psi_i = \omega + \sum_{j=0}^m \alpha_j \log x_{i-j} + \sum_{j=0}^q \beta_j \psi_{i-j}$

The same constraint as above holds. 

Log-SCD models can also be obtained in a similar manner as done for the ACD. 

## FIACD Model

- Many financial duration series show a hyperbolic decay, i.e., significant autocorrelations up to long lags.

-  This suggests that a better fit might be obtained by accounting for longer term dependence in durations.

- Jasiak (1998) \cite{FIACD} proposes the Fractionally Integrated ACD (FIACD) model that extends the standard ACD model to include long range durations dependence.

The FIACD(m, d, q) model is defined as:

$(1-B)^dx_i = \psi_i \epsilon_i$

$\psi_i = \omega + \sum_{j=1}^p \alpha_j x_{i-j} + \sum_{j=1}^q \beta_j \psi_{i-j}$

## FIACD Model (Cont..)

where:

$\omega$, $\alpha_j$ and $\beta_j$ > 0.

$\sum_{j=1}^{max(p,q)}\ (\alpha + \beta) < 1$

$B$ denote the backshift operator.

-0.5 < d < 0.5 is the fractional differencing parameter such that

$(1-B)^d=\sum_{k=0}^{\infty}\frac{\Gamma(d+1)}{\Gamma(k+1)\Gamma(d-k+1)}(-1)^kB^k$, 

## AACD Model

- The standard ACD model cannot fully capture nonlinear dependence between conditional duration and past information set.

- Conditional durations are overpredicted by the linear specification after very short or very long durations.

- Fernandes and Grammig (2006) introduce a class of augmented ACD (AACD) models encompassing most of the existing models including that models to handle nonlinearity.

- The AACD models are obtained by applying a Box-Cox transformation to the conditional duration process and a nonlinear function of $\epsilon_i$ that allows asymmetric responses to small and large shocks.

## AACD Model (Cont..)

The AACD model is defined as:

$x_i=\psi_i\epsilon_i$ 

$\psi_i^{\lambda}=\omega+\alpha_j\psi_{i-1}^{\lambda}[|\epsilon_{i-1}-b|+c(\epsilon_{i-1}-b)]^{\nu}+\beta_j\psi_{i-1}^{\lambda}+\sum_{j=1}^r\delta_jz_{i-1,j}$

where $\omega > 0$, $\beta > 0$, $\alpha > 0$

The parameter $\lambda$ determines whether the Box–Cox transformation is concave or convex.

The asymmetric response to shocks and the shape of the piecewise function depend on parameters $b$ and $c$.

The parameter $\nu$ induces concavity or convexity to the shock impact curve.

## Likelihood Function for duration models

Let ($x_1,...,x_n$) be the observed durations. 

And $\theta=(\omega, \alpha_1, ..., \alpha_p, \beta_1,..., \beta_q)$ be the parameters that needs to be estimated and let g = max(p, q). 

The likelihood function of the data is:

$f(x_n|\theta)=f(x_g|\theta)\prod_{i=g+1}^nf(x_i|x_{i-1},\theta)$

The marginal density of $f(x_g|\theta)$ is complicated for the ACD model. And because its impact on the likelihood function is diminishing as the $n$ increases, this marginal density is often ignored, resulting in use of the conditional-likelihood method (Tsay, 2009 \cite{ACDtext}).

## Likelihood Function for ACD

Let us consider an ACD Model. The main assumption of the ACD model is that the standardized durations

$\epsilon_i=\frac{x_i}{\psi_i}$

are iid with $E(\epsilon_i)=1$

Let $f_{\epsilon}$ be the density of $\epsilon$. Then:

$f(x_i|x_{i-1},\theta)=\frac{1}{\psi_i}f_{\epsilon}$

The log-likelihood function is given by

$L(\theta|x_n)=\sum_{i=1}^n[-\log(\psi_i)+f_{\epsilon}]$\

## Likelihood Function for ACD (Cont..)

If we assume that the error terms follow an exponential distribution then the likelihood function for the ACD model is:

$l(\theta|x_n)=\prod_{i=1}^n\frac{1}{\psi_i}exp(\frac{-x_i}{\psi_i})$

Then the corresponding log likelihood is:

$L(\theta|x_n)=\sum_{i=1}^n-\log(\psi_i)-(\frac{x_i}{\psi_i})$

$L(\theta|x_n)=-\sum_{i=1}^n[\log(\psi_i)+(\frac{x_i}{\psi_i})]$

## Likelihood Function for Log-ACD

Similarly if we assume that the error follows an exponential distribution then the likelihood function for the Log-ACD model is:

$l(\theta|x_n)=\prod_{i=1}^n\frac{1}{\exp(\psi_i)}exp(\frac{-x_i}{\exp(\psi_i)})$

Then the corresponding log likelihood is:

$L(\theta|x_n)=\sum_{i=1}^n-\psi_i-(\frac{x_i}{exp(\psi_i)})$

$L(\theta|x_n)=-\sum_{i=1}^n[\psi_i+(\frac{x_i}{exp(\psi_i)})]$

## Other ways to estimate the parameters

- Sometimes it is not possible to assume a distribution for the errors in practice. 

- In order to accommodate for that, distribution free approaches were introduced. 

- One such approach is based on the combined martingale estimation functions which does not have any distributional assumption as discussed in Thavaneswaran et al (2015) \cite{EE} for a class of generalized duration models. 

- It is similar to the generalized method of moments as it only requires the first four conditional moments of the durations. 

- This is done by deriving optimal combined estimating equations based on both linear and generalized martingale differences, and by proposing recursive estimating equations based on the combined estimating equations.

## Data Source

- The data is obtained from two main portals: the National Oceanic and Atmospheric Administration (NOAA) and the United States Army Corps of Engineers (USACE) database. 

- Buoy fleets are independently owned and operated by universities, private research institutes, and government agencies. 

- The data is from NOAA buoy 44039 in the Central Long Island Sound. 

## Data Description

The dataset contains the following variables: 

- Year 

- Month

- Day

- Hour 

- Wave height

- Wind speed

- Fetch

- Wind speed square

- Z2 

- Z3 

- Z4

## Data Description (Cont..)

The variables Z2, Z3 and Z4 are computed as follows:

$Z_{2,t-r} = Speed_{t-r} \sqrt{Fetch_{t-r}}$

$Z_{3,t-r} = Fetch_{t-r}$

$Z_{4,t-r} = \frac{Fetch_{t-r}^{3/2}}{Speed_{t-r}}$

## Data Preparation

- The data is available for each hour from the 11-01-2004 to 10-31-2013. 

- Each year can be divided into two periods: (i) Windy Months (Nov-Mar) (ii) Calm Months (Apr-Oct). 

So modeling can also be done in two ways: 

(i) Consider entire day as a single time series and build the model or

(ii) Consider yearly data for Calm/Windy period and build models for each period/year.

## Duration in the data

- The durations are calculated based on some threshold for the wave heights and they are calculated in hours. 

For example if we consider the threshold for wave heights as 2ft then the duration is calculated as follows:

$x_i = t_i - t_{i-1}$

where $x_i$ is $i^{th}$ hourly duration and $t_i$ is $i^{th}$ time point when the wave height reaches 2ft.  

- So we can do this based on 3 different thresholds: 2ft, 3ft and 4ft. 

- The durations are calculated as the difference in the hourly time for a wave to reach a threshold. 

## Plots of Durations

1) Duration plot for the entire data based on 2ft threshold:

```{r  label = "2ft durations", echo = FALSE, fig.cap = "Wave duration at 2ft threshold", out.width = '100%'}
knitr::include_graphics("dur_plot_2ft.png")
```

## Plot of Durations (Cont..)

2) Duration plot for the entire data based on 3ft threshold:

```{r  label = "3ft durations", echo = FALSE, fig.cap = "Wave duration at 3ft threshold", out.width = '100%'}
knitr::include_graphics("dur_plot_3ft.png")
```

## Plot of Durations (Cont..)

3) Duration plot for the entire data based on 4ft threshold:

```{r  label = "4ft durations", echo = FALSE, fig.cap = "Wave duration at 4ft threshold", out.width = '100%'}
knitr::include_graphics("dur_plot_4ft.png")
```

## Plots based on Calm Season

1) Duration plot for calm period based on 2ft threshold for the year 2008:

```{r  label = "Calm Season", echo = FALSE, fig.cap = "Wave duration of Calm Season for the year 2008", out.width = '100%'}
knitr::include_graphics("Picture1.png")
```

## Plots based on Windy Season

2) Duration plot for Windy period based on 2ft threshold for the year 2008:

```{r  label = "Windy Season", echo = FALSE, fig.cap = "Wave duration of Windy Season for the year 2008", out.width = '100%'}
knitr::include_graphics("Picture2.png")
```

## Log-ACD Model with exogenous variables

We define the durations $x_i$ with exogenous variables as:

$x_i = e^{\psi_i} \epsilon_i$

where $\epsilon_i ~$ i.i.d with some density. 

and 

$\psi_i = \omega + \sum_{j=0}^m \alpha_j ln x_{i-j} + \sum_{j=0}^q \beta_j \psi_{i-j}+\sum_{j=1}^r\delta_jz_{i,j}$

Where $z_{i,j}$ are the exogenous variables. 

The exogenous variables used for modeling are $wind speed square, z2, z3, z4$. 

The missing data in the exogenous variables were backfilled. 

## Procedure

- The first step was to identify the initial parameter values. 

- This was done using the properties of non-Gaussian autoregressive moving average (ARMA) models. 

- We first take the logarithmic transformation of the durations $x_i$ and then fit an $ARMA(Max(p,q),q)$ model to the log transformed durations. 

- Then based on the coefficients of the ARMA model we can obtain our initial value estimate.

- This can be done using the *arima* function in R using the *method as CSS* which corresponds to minimizing the conditional sum-of-squares.

## Procedure (Cont..)

- The second step is to fit the model using the initial values we obtained for the parameters.

- The final set of parameters are estimated using the conditional likelihood approach. 

- This can be done using the *optim* function or *nlminb* function in R. 

- The third step is to do a *h-step* ahead forecast.

- Then compute the Mean absolute percentage error (MAPE) for the forecasts. 

## Simulation Study 1

Several simulation studies were conducted to see if the model was able to return fitted values close to the values used to simulate the datasets. All simulations are based on exponential distributions for the errors. 

The results for Log-ACD(2,1) are as follows:

\begin{tabular}{ |p{2cm}|p{2cm}|p{2cm}|p{2cm}|  }
 \hline
 Parameters& Simulated & Fitted \\
 \hline
 Omega   & 0.30 & 0.33 \\
  \hline
 Alpha1   & 0.20 & 0.17 \\
  \hline
 Beta   & 0.70 & 0.65 \\
  \hline
 Delta  & 0  & 0 \\
  \hline
\end{tabular}

The simulation results are based on average of 10 simulations of size 1500. Also note that the exogenous variables coefficient are considered to be zero.

## Simulation Study 2

The results for Log-ACD(1,1) are as follows:

\begin{tabular}{ |p{2cm}|p{2cm}|p{2cm}|  }
 \hline
 Parameters& Simulated & Fitted \\
 \hline
 Omega   & 0.30 & 0.31  \\
  \hline
 Alpha1   & 0.01 & 0.01  \\
  \hline
 Beta1  & 0.60 & 0.60  \\
  \hline
 Delta1   & 0.08 & 0.08  \\
  \hline
 Delta2   & -0.61 & -0.63  \\
  \hline
 Delta3   & 0.75 & 0.78   \\
  \hline
 Delta4   & -0.31 & -0.34 \\
  \hline
\end{tabular}

The simulation results are based on average of 100 simulations of size 1500.

## Simulation Study 3

The results for Log-ACD(5,3) are as follows:

\begin{tabular}{ |p{2cm}|p{2cm}|p{2cm}|  }
 \hline
 Parameters& Simulated & Fitted \\
 \hline
 Omega   & 0.10 & 0.10  \\
  \hline
 Alpha1   & 0.10 & 0.10  \\
  \hline
 Alpha2  & 0.20 & 0.19  \\
  \hline
 Alpha3   & -0.10 & -0.11  \\
  \hline
 Alpha4   & 0.02 & 0.03  \\
  \hline
 Alpha5   & -0.15 & -0.15   \\
  \hline
 Beta1   & 0.70 & 0.74 \\
  \hline
 Beta2   & 0 & 0.01 \\
  \hline
 Beta3   & 0 & 0 \\
  \hline
 Delta   & 0.05 & 0.05 \\
  \hline
\end{tabular}

The simulation results are based on average of 100 simulations of size 1500.

## Model fits

All outputs are based on the durations computed for windy period for the year 2010 with a threshold of 2ft. 

The results for Log-ACD(2,1) are as follows:

\begin{tabular}{ |p{2cm}|p{2cm}|p{2cm}|p{2cm}|  }
 \hline
 Parameters & Initial & Fitted \\
 \hline
 Omega   & 0.01 & 0.21 \\
  \hline
 Alpha1    & 0.05 & -0.02 \\
  \hline
 Alpha2   & -0.01 & 0.09 \\
  \hline
 Beta    & 0.95 & 0.85 \\
  \hline
 Delta   & 0  & 0 \\
  \hline
\end{tabular}

## Model fits (Cont..)

This table shows the reuslts based on the model using the four exogenous variables: wind speed square, z2, z3 and z4. 

The results for Log-ACD(2,1) are as follows:

\begin{tabular}{ |p{2cm}|p{2cm}|p{2cm}|p{2cm}|  }
 \hline
 Parameters& Initial & Fitted  \\
 \hline
 Omega   & 0.03 & 0.23 \\
  \hline
 Alpha1   & 0.06 & 0.11 \\
  \hline
 Alpha2   & 0.03 & -0.02 \\
  \hline
 Beta   & -0.11 & 0.20 \\
  \hline
 Delta1   & 0.45 & 0.40  \\
  \hline
 Delta2   & -1.19 & -1.26  \\
  \hline
 Delta3   & 1.18 & 1.24  \\
  \hline
 Delta4   & -0.31 & -0.35  \\
  \hline
\end{tabular}

## Forecast evaluation

- The MAPE for 5-step ahead forecast for the model without exogenous variables was 23.33.

- The MAPE for 5-step ahead forecast for the model with exogenous variables was 81.03.

- We can see that the model without the exogenous variables have a lower MAPE compared to the model with the exogenous variables. 

- This may be because of the nature of exogenous variables. 

- We can see that the model is able to fit the durations well even for applications outside of financial domain.

## Summary

- Duration models are a family of models based on ARCH/GARCH framework.

- Instead of modeling the conditional variances we model the conditional mean of durations.

- Duration models are very useful in studying irregularly spaced financial transaction level data.

- Here we have shown several simulation study along with an example of fitting an duration model to a data outside of financial application by modeling wave height durations.

## References

\begin{thebibliography}{10}
\bibitem{ACD}
\alert{Robert F. Engle and Jeffrey R. Russell}
\newblock  {Autoregressive Conditional Duration: A New Model For Irregularly Spaced Transaction Data.}
\newblock {\em Econometrica, Vol. 66, No. 5 (September, 1998)}.

\bibitem{LogACD}
\alert{Luc Bauwens, Pierre Giot.}
\newblock  {The Logarithmic ACD Model: An Application to the Bid-Ask Quote Process of Three NYSE Stocks.}
\newblock {\em Annales d'Économie et de Statistique, Volume 131, 2000}.

\bibitem{SCD}
\alert{Luc Bauwens and David Veredas}
\newblock  {The stochastic conditional duration model: a latent variable model for the analysis of financial durations}
\newblock {\em Journal of Econometrics, Volume 119, 2004}.

\bibitem{FIACD}
\alert{Joann Jasiak}
\newblock  {Persistence in Intertrade Durations}
\newblock {\em Capital Markets: Market Microstructure, 1999}.
\end{thebibliography}

## References (Cont..)

\begin{thebibliography}{10}
\bibitem{AACD}
\alert{Marcelo Fernandes and Joachim Grammig}
\newblock  {A family of autoregressive conditional duration models}
\newblock {\em Journal of Econometrics, Volume 130, 2006}.

\bibitem{ACDtext}
\alert{R. Tsay}
\newblock  {Autoregressive Conditional Duration Models. In: Palgrave Handbook of Econometrics: Volume 2: Applied Econometrics}
\newblock {\em Palgrave Macmillan UK, 2009.}.

\bibitem{EE}
\alert{Aerambamoorthy Thavaneswaran , Nalini Ravishanker , You Liang}
\newblock  {Generalized duration models and optimal estimation using estimating functions}
\newblock {\em Annals of the Institute of Statistical Mathematics, Volume 67, March 2015}.
\end{thebibliography}
